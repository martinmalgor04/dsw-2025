openapi: 3.0.3
info:
  title: ðŸ“¦ API de LogÃ­stica - Grupo 12 TPI 2025
  version: "1.0.0"
  description: |
    **API de LogÃ­stica y Transporte** para el proyecto TPI 2025
    
    Esta API proporciona funcionalidades completas para la gestiÃ³n de envÃ­os y logÃ­stica:
    
    - ðŸ’° **CÃ¡lculo de costos** de envÃ­o con productos y distancias
    - ðŸšš **GestiÃ³n de envÃ­os** con tracking y estados
    - ðŸš› **MÃ©todos de transporte** disponibles
    - ðŸ“Š **Seguimiento y monitoreo** de envÃ­os
    
    **Desarrollado por:** Grupo 12 - Desarrollo de Software 2025
    
    **IntegraciÃ³n con otros mÃ³dulos:**
    - **Stock Module**: Consulta de productos, peso, dimensiones y ubicaciÃ³n de almacÃ©n
    - **Order Management**: GestiÃ³n de pedidos y usuarios
    - **Frontend**: Interfaz de usuario para clientes
    
    **Flujo de trabajo:**
    1. Cliente selecciona productos y direcciÃ³n de entrega
    2. Sistema calcula costos de envÃ­o para diferentes mÃ©todos de transporte
    3. Cliente elige mÃ©todo de transporte preferido
    4. Sistema crea envÃ­o con tracking number
    5. Seguimiento en tiempo real del estado del envÃ­o
  contact:
    name: Grupo 12 - TPI 2025
    url: https://github.com/FRRe-DS/2025-12-TPI
    email: grupo12@tpi.com
  termsOfService: 'http://frre.utn.edu.ar/terminos'
  license:
    name: MIT
    url: 'https://opensource.org/licenses/MIT'
servers:
  - url: https://api.logistica-utn.com
    description: Servidor de producciÃ³n
  - url: http://localhost:3000
    description: Servidor de desarrollo local

tags:
  - name: "ðŸ›’ Compras â†’ LogÃ­stica"
    description: |
      **Requests desde el mÃ³dulo de Compras hacia LogÃ­stica**
      
      Este grupo incluye las operaciones que el mÃ³dulo de **Compras** realiza hacia LogÃ­stica:
      - **CÃ¡lculo de costos** antes de finalizar la compra
      - **CreaciÃ³n de envÃ­os** despuÃ©s de confirmar la compra
      - **Consulta de mÃ©todos de transporte** para mostrar opciones al cliente
      - **Seguimiento de envÃ­os** para mostrar estado al cliente
      
      **Flujo tÃ­pico:**
      1. Cliente selecciona productos â†’ Compras consulta costos de envÃ­o
      2. Cliente elige mÃ©todo de transporte â†’ Compras confirma compra
      3. Compras crea envÃ­o en LogÃ­stica â†’ Recibe tracking number
      4. Cliente consulta estado â†’ Compras obtiene detalles del envÃ­o
  
  - name: "ðŸ“¦ Stock â†’ LogÃ­stica"
    description: |
      **Requests desde el mÃ³dulo de Stock hacia LogÃ­stica**
      
      Este grupo incluye las operaciones que el mÃ³dulo de **Stock** realiza hacia LogÃ­stica:
      - **ValidaciÃ³n de productos** antes de crear envÃ­os
      - **Consulta de informaciÃ³n** de productos para cÃ¡lculos
      - **ActualizaciÃ³n de inventario** despuÃ©s de envÃ­os
      
      **Flujo tÃ­pico:**
      1. Stock valida disponibilidad de productos
      2. Stock proporciona peso y dimensiones para cÃ¡lculos
      3. Stock actualiza inventario despuÃ©s de envÃ­os confirmados
  
  - name: "ðŸ” LogÃ­stica â†’ Consultas Internas"
    description: |
      **Operaciones internas del mÃ³dulo de LogÃ­stica**
      
      Este grupo incluye operaciones que LogÃ­stica realiza internamente o para consultas directas:
      - **Listado de envÃ­os** con filtros
      - **Detalles especÃ­ficos** de envÃ­os
      - **CancelaciÃ³n de envÃ­os** (solo en estados tempranos)
      - **MÃ©todos de transporte** disponibles
      
      **Uso:** Principalmente para administraciÃ³n y consultas directas del sistema de logÃ­stica.

paths:
  # ===========================
  # SHIPPING COST CALCULATION
  # ===========================
  /shipping/cost:
    post:
      tags:
        - "ðŸ›’ Compras â†’ LogÃ­stica"
      summary: ðŸ’° Calcular costo de envÃ­o
      description: |
        **REQUEST: Compras â†’ LogÃ­stica**
        
        **CÃ¡lculo de costos de envÃ­o** sin crear recursos permanentes.
        El mÃ³dulo de **Compras** utiliza este endpoint para mostrar opciones de envÃ­o a los clientes antes de finalizar la compra.
        
        **Flujo de ComunicaciÃ³n entre MÃ³dulos:**
        1. **Compras** envÃ­a: direcciÃ³n de entrega + IDs de productos con cantidades
        2. **LogÃ­stica** consulta al mÃ³dulo **Stock** para CADA producto:
           - GET /products/{id} â†’ retorna peso, dimensiones, cÃ³digo postal del almacÃ©n
        3. **LogÃ­stica** calcula:
           - Peso total = suma(producto.peso * cantidad)
           - Volumen total = suma(dimensiones del producto * cantidad)
           - Distancia = desde warehouse_postal_code hasta delivery_address.postal_code
        4. **LogÃ­stica** retorna costo estimado a **Compras**
        5. **Compras** muestra opciones al cliente (NO se persisten datos)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ShippingCostRequest"
            examples:
              sample:
                value:
                  delivery_address:
                    street: "Av. Dirac 1234"
                    city: "Resistencia"
                    state: "Chaco"
                    postal_code: "H3500ABC"
                    country: "AR"
                  products:
                    - id: 1
                      quantity: 2
                    - id: 2
                      quantity: 1
      responses:
        "200":
          description: Shipping cost calculated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ShippingCostResponse"
              examples:
                sample:
                  value:
                    currency: "ARS"
                    total_cost: 45.5
                    transport_type: "air"
                    products:
                      - id: 1
                        cost: 20.0
                      - id: 2
                        cost: 25.5
        "400":
          $ref: "#/components/responses/Error400"
        "401":
          $ref: "#/components/responses/Error401"
        "422":
          $ref: "#/components/responses/Error422"
        "500":
          $ref: "#/components/responses/Error500"

  # ===========================
  # TRANSPORT METHODS
  # ===========================
  /shipping/transport-methods:
    get:
      tags:
        - "ðŸ›’ Compras â†’ LogÃ­stica"
      summary: ðŸš› Obtener mÃ©todos de transporte
      description: |
        **REQUEST: Compras â†’ LogÃ­stica**
        
        **Obtiene la lista de mÃ©todos de transporte disponibles** que pueden utilizarse para envÃ­os.
        El mÃ³dulo de **Compras** utiliza este endpoint para mostrar opciones de envÃ­o a los clientes durante el proceso de checkout.
        
        **Flujo de ComunicaciÃ³n:**
        1. **Compras** consulta mÃ©todos disponibles a **LogÃ­stica**
        2. **LogÃ­stica** retorna lista con tipos y tiempos estimados
        3. **Compras** muestra opciones al cliente (Air: 1-3 dÃ­as, Road: 3-7 dÃ­as, etc.)
        4. Cliente selecciona mÃ©todo preferido
        5. **Compras** usa mÃ©todo seleccionado en cÃ¡lculo de costos
        
        **MÃ©todos disponibles:**
        - **Air**: MÃ¡s rÃ¡pido (1-3 dÃ­as) pero mÃ¡s costoso
        - **Road**: Velocidad media (3-7 dÃ­as), mÃ¡s flexible
        - **Rail**: Medio-lento (5-10 dÃ­as), bueno para carga pesada
        - **Sea**: MÃ¡s lento (15-30 dÃ­as) pero mÃ¡s econÃ³mico para grandes volÃºmenes
      security:
        - bearerAuth: []
      responses:
        "200":
          description: List of available transport methods
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TransportMethodsResponse"
              examples:
                sample:
                  value:
                    transport_methods:
                      - type: "air"
                        name: "Air Freight"
                        estimated_days: "1-3"
                      - type: "road"
                        name: "Road Transport"
                        estimated_days: "3-7"
                      - type: "rail"
                        name: "Rail Freight"
                        estimated_days: "5-10"
                      - type: "sea"
                        name: "Sea Freight"
                        estimated_days: "15-30"
        "401":
          $ref: "#/components/responses/Error401"
        "500":
          $ref: "#/components/responses/Error500"

  # ===========================
  # SHIPMENT CREATION
  # ===========================
  /shipping:
    post:
      tags:
        - "ðŸ›’ Compras â†’ LogÃ­stica"
      summary: ðŸšš Crear envÃ­o
      description: |
        **REQUEST: Compras â†’ LogÃ­stica**
        
        **Crea un nuevo envÃ­o** para una orden con el mÃ©todo de transporte seleccionado por el cliente.
        El mÃ³dulo de **Compras** utiliza este endpoint despuÃ©s de que el cliente confirma la compra.
        
        **Flujo de ComunicaciÃ³n entre MÃ³dulos:**
        
        **1. Proceso de Compras (Frontend):**
        - Cliente agrega productos al carrito
        - Cliente ingresa direcciÃ³n de entrega
        - **Compras** consulta GET /shipping/transport-methods
        - **Compras** consulta POST /shipping/cost para cada opciÃ³n
        - Cliente ve: "Air Freight: $45.50 (1-3 dÃ­as)" etc.
        - Cliente selecciona mÃ©todo y completa pago
        - **Compras** crea orden #123
        
        **2. ComunicaciÃ³n entre MÃ³dulos:**
        1. **Compras** â†’ **LogÃ­stica**: EnvÃ­a order_id, user_id, delivery_address, transport_type, product IDs
        2. **LogÃ­stica** â†’ **Stock**: Consulta GET /products/{id} para cada producto
        3. **Stock** â†’ **LogÃ­stica**: Retorna peso, dimensiones, warehouse_postal_code
        4. **LogÃ­stica** valida:
           - Productos existen en Stock
           - Stock suficiente disponible
           - transport_type vÃ¡lido
        5. **LogÃ­stica** calcula costo final y crea envÃ­o
        6. **LogÃ­stica** â†’ **Compras**: Retorna shipping_id y tracking_number
        7. **Compras** vincula shipping_id a Orden #123
        
        **Nota:** El mÃ³dulo **Stock** es la fuente de verdad para peso, dimensiones y ubicaciÃ³n de almacÃ©n.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateShippingRequest"
            examples:
              sample:
                value:
                  order_id: 123
                  user_id: 456
                  delivery_address:
                    street: "Av. Siempre Viva 123"
                    city: "Resistencia"
                    state: "Chaco"
                    postal_code: "H3500ABC"
                    country: "AR"
                  transport_type: "air"
                  products:
                    - id: 1
                      quantity: 1
                    - id: 2
                      quantity: 2
      responses:
        "201":
          description: Shipment created successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CreateShippingResponse"
              examples:
                sample:
                  value:
                    shipping_id: 789
                    status: "created"
                    transport_type: "air"
                    estimated_delivery_at: "2025-10-01T00:00:00Z"
        "400":
          $ref: "#/components/responses/Error400"
        "401":
          $ref: "#/components/responses/Error401"
        "409":
          $ref: "#/components/responses/Error409"
        "422":
          $ref: "#/components/responses/Error422"
        "500":
          $ref: "#/components/responses/Error500"

    # ===========================
    # LIST SHIPMENTS WITH FILTERS
    # ===========================
    get:
      tags:
        - "ðŸ” LogÃ­stica â†’ Consultas Internas"
      summary: ðŸ“‹ Listar envÃ­os
      description: |
        **CONSULTA INTERNA: LogÃ­stica**
        
        **Retorna una lista paginada de envÃ­os** con filtros opcionales.
        Utilizado internamente por el sistema de logÃ­stica para administraciÃ³n y reportes.
        
        **Casos de uso internos:**
        - **AdministraciÃ³n**: Visualizar todos los envÃ­os del sistema
        - **Reportes operativos**: Filtrar por estado, fechas, usuarios
        - **AnÃ¡lisis**: Consultas por rango de fechas para mÃ©tricas
        - **Soporte**: Buscar envÃ­os especÃ­ficos para atenciÃ³n al cliente
        
        **Filtros disponibles:**
        - **user_id**: Filtrar por ID de usuario
        - **status**: Filtrar por estado del envÃ­o
        - **from_date**: Filtrar envÃ­os creados desde esta fecha
        - **to_date**: Filtrar envÃ­os creados hasta esta fecha
        - **page**: NÃºmero de pÃ¡gina para paginaciÃ³n
        - **limit**: Cantidad de resultados por pÃ¡gina
        
        **Nota:** Todos los filtros son opcionales. Sin filtros, retorna todos los envÃ­os (paginado).
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: user_id
          schema:
            type: integer
          description: Filter by user ID
          example: 456
        - in: query
          name: status
          schema:
            $ref: "#/components/schemas/ShippingStatus"
          description: Filter by shipment status
          example: "in_transit"
        - in: query
          name: from_date
          schema:
            type: string
            format: date
          description: Filter shipments created from this date (ISO 8601)
          example: "2025-01-01"
        - in: query
          name: to_date
          schema:
            type: string
            format: date
          description: Filter shipments created until this date (ISO 8601)
          example: "2025-12-31"
        - in: query
          name: page
          schema:
            type: integer
            minimum: 1
            default: 1
          description: Page number for pagination
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
          description: Number of results per page
      responses:
        "200":
          description: List of shipments matching filters
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ShippingListResponse"
              examples:
                sample:
                  value:
                    shipments:
                      - shipping_id: 789
                        order_id: 123
                        user_id: 456
                        products:
                          - product_id: 12
                            quantity: 2
                          - product_id: 22
                            quantity: 1
                        status: "in_distribution"
                        transport_type: "air"
                        estimated_delivery_at: "2025-10-01T00:00:00Z"
                        created_at: "2025-09-01T10:00:00Z"
                      - shipping_id: 790
                        order_id: 124
                        user_id: 456
                        products:
                          - product_id: 31
                            quantity: 3
                        status: "delivered"
                        transport_type: "road"
                        estimated_delivery_at: "2025-09-15T00:00:00Z"
                        created_at: "2025-09-05T14:30:00Z"
                    pagination:
                      current_page: 1
                      total_pages: 5
                      total_items: 87
                      items_per_page: 20
        "401":
          $ref: "#/components/responses/Error401"
        "422":
          $ref: "#/components/responses/Error422"
        "500":
          $ref: "#/components/responses/Error500"

  # ===========================
  # SHIPMENT DETAILS
  # ===========================
  /shipping/{shipping_id}:
    get:
      tags:
        - "ðŸ›’ Compras â†’ LogÃ­stica"
      summary: ðŸ” Obtener detalle de envÃ­o
      description: |
        **REQUEST: Compras â†’ LogÃ­stica**
        
        **Obtiene detalles completos** de un envÃ­o especÃ­fico incluyendo estado, tracking y historial.
        El mÃ³dulo de **Compras** utiliza este endpoint para mostrar el estado del envÃ­o a los clientes.
        
        **Flujo de ComunicaciÃ³n:**
        1. Cliente consulta estado de su envÃ­o en **Compras**
        2. **Compras** â†’ **LogÃ­stica**: EnvÃ­a shipping_id
        3. **LogÃ­stica** retorna informaciÃ³n completa del envÃ­o
        4. **Compras** muestra estado actualizado al cliente
        
        **InformaciÃ³n incluida:**
        - **Estado actual** del envÃ­o
        - **Direcciones completas** de entrega y salida
        - **Productos asociados** con cantidades
        - **InformaciÃ³n de tracking** (nÃºmero de seguimiento, transportista)
        - **Historial completo** de cambios de estado (logs)
        - **InformaciÃ³n de costo** y transporte
        
        **Estados del envÃ­o:**
        - **created**: Registro de envÃ­o creado, aÃºn no despachado
        - **reserved**: Inventario reservado, esperando despacho
        - **in_transit**: Paquete en trÃ¡nsito hacia destino
        - **arrived**: Paquete llegÃ³ a instalaciÃ³n de destino
        - **in_distribution**: En distribuciÃ³n a direcciÃ³n final
        - **delivered**: Entregado exitosamente al cliente
        - **cancelled**: EnvÃ­o cancelado
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: shipping_id
          required: true
          schema:
            type: integer
          description: Unique shipment identifier
          example: 789
      responses:
        "200":
          description: Shipment details retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ShippingDetail"
              examples:
                sample:
                  value:
                    shipping_id: 789
                    order_id: 123
                    user_id: 456
                    delivery_address:
                      street: "Av. Siempre Viva 123"
                      city: "Resistencia"
                      state: "Chaco"
                      postal_code: "H3500ABC"
                      country: "AR"
                    departure_address:
                      street: "Warehouse Central"
                      city: "Resistencia"
                      state: "Chaco"
                      postal_code: "H3500XYZ"
                      country: "AR"
                    products:
                      - product_id: 12
                        quantity: 2
                      - product_id: 22
                        quantity: 1
                    status: "in_distribution"
                    transport_type: "air"
                    tracking_number: "LOG-AR-123456789"
                    carrier_name: "Express Logistics SA"
                    total_cost: 45.5
                    currency: "ARS"
                    estimated_delivery_at: "2025-10-01T00:00:00Z"
                    created_at: "2025-09-01T10:00:00Z"
                    updated_at: "2025-09-15T09:29:00Z"
                    logs:
                      - timestamp: "2025-09-15T09:29:00Z"
                        status: "in_distribution"
                        message: "Shipment is in distribution"
                      - timestamp: "2025-09-12T09:27:00Z"
                        status: "arrived"
                        message: "Package arrived at delivery office"
                      - timestamp: "2025-09-10T08:15:00Z"
                        status: "in_transit"
                        message: "Package in transit"
                      - timestamp: "2025-09-01T10:00:00Z"
                        status: "created"
                        message: "Shipment created"
        "401":
          $ref: "#/components/responses/Error401"
        "404":
          $ref: "#/components/responses/Error404"
        "500":
          $ref: "#/components/responses/Error500"

  # ===========================
  # CANCEL SHIPMENT
  # ===========================
  /shipping/{shipping_id}/cancel:
    post:
      tags:
        - "ðŸ” LogÃ­stica â†’ Consultas Internas"
      summary: âŒ Cancelar envÃ­o
      description: |
        **CONSULTA INTERNA: LogÃ­stica**
        
        **Cancela un envÃ­o existente** que aÃºn no ha sido despachado.
        Utilizado internamente por el sistema de logÃ­stica para gestiÃ³n de cancelaciones.
        
        **Flujo de CancelaciÃ³n:**
        1. **LogÃ­stica** valida que el envÃ­o puede ser cancelado
        2. **LogÃ­stica** cambia estado a 'cancelled'
        3. **LogÃ­stica** â†’ **Stock**: Notifica cancelaciÃ³n (para devoluciÃ³n de inventario)
        4. **LogÃ­stica** â†’ **Compras**: Notifica cancelaciÃ³n (para reembolso)
        
        **Restricciones:**
        - Solo se pueden cancelar envÃ­os con estado 'created' o 'reserved'
        - Una vez en estado 'in_transit' o etapas posteriores, no se puede cancelar
        
        **Estados que permiten cancelaciÃ³n:**
        - **created**: EnvÃ­o creado pero no despachado
        - **reserved**: Inventario reservado, esperando despacho
        
        **Estados que NO permiten cancelaciÃ³n:**
        - **in_transit**: Ya en trÃ¡nsito
        - **arrived**: Ya llegÃ³ al destino
        - **in_distribution**: En distribuciÃ³n
        - **delivered**: Ya entregado
        - **cancelled**: Ya cancelado
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: shipping_id
          required: true
          schema:
            type: integer
          description: Unique shipment identifier
          example: 789
      responses:
        "200":
          description: Shipment cancelled successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CancelShippingResponse"
              examples:
                sample:
                  value:
                    shipping_id: 789
                    status: "cancelled"
                    cancelled_at: "2025-09-18T19:00:00Z"
        "400":
          description: Shipment cannot be cancelled in current status
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
              examples:
                state_conflict:
                  value:
                    code: "bad_request"
                    message: "Shipment cannot be cancelled. Current status 'in_transit' does not allow cancellation."
        "401":
          $ref: "#/components/responses/Error401"
        "404":
          $ref: "#/components/responses/Error404"
        "409":
          $ref: "#/components/responses/Error409"
        "500":
          $ref: "#/components/responses/Error500"

# ===========================
# COMPONENTS
# ===========================
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token obtained from authentication service

  schemas:
    # ===========================
    # ADDRESS SCHEMA
    # ===========================
    Address:
      type: object
      required: [street, city, state, postal_code, country]
      properties:
        street:
          type: string
          description: Street address including number
          example: "Av. Dirac 1234"
        city:
          type: string
          description: City name
          example: "Resistencia"
        state:
          type: string
          description: State/Province name
          example: "Chaco"
        postal_code:
          type: string
          description: Argentinian postal code format (CPA)
          pattern: '^([A-Z]{1}\d{4}[A-Z]{3})$'
          example: "H3500ABC"
        country:
          type: string
          description: ISO-3166-1 alpha-2 country code
          minLength: 2
          maxLength: 2
          example: "AR"

    # ===========================
    # PRODUCT REQUEST SCHEMA
    # ===========================
    ProductRequest:
      type: object
      required: [id, quantity]
      description: |
        Simplified product reference for requests.
        Only product ID and quantity are sent by Order Management.
        Logistics module queries Stock module for complete product details:
        - Weight and dimensions (for cost/volume calculation)
        - Warehouse location (departure address)
      properties:
        id:
          type: integer
          description: Product ID from Stock module
          example: 1
        quantity:
          type: integer
          minimum: 1
          description: Number of units of this product
          example: 2

    # ===========================
    # PRODUCT DETAILS (FROM STOCK)
    # ===========================
    ProductDetails:
      type: object
      required: [id, weight, length, width, height]
      description: |
        Complete product information obtained from Stock module.
        This schema documents what Logistics expects to receive from Stock API.
        NOT sent in requests, but used internally for calculations.
      properties:
        id:
          type: integer
          description: Product ID
          example: 1
        weight:
          type: number
          format: float
          minimum: 0.01
          description: Weight per unit in kilograms
          example: 1.5
        length:
          type: number
          format: float
          minimum: 0.01
          description: Length in centimeters
          example: 30
        width:
          type: number
          format: float
          minimum: 0.01
          description: Width in centimeters
          example: 20
        height:
          type: number
          format: float
          minimum: 0.01
          description: Height in centimeters
          example: 10

    # ===========================
    # PRODUCT QUANTITY SCHEMA
    # ===========================
    ProductQty:
      type: object
      required: [product_id, quantity]
      description: Simplified product reference with quantity
      properties:
        product_id:
          type: integer
          description: Product ID from Inventory module
          example: 12
        quantity:
          type: integer
          minimum: 1
          description: Number of units
          example: 2

    # ===========================
    # SHIPPING LOG SCHEMA
    # ===========================
    ShippingLog:
      type: object
      required: [timestamp, status, message]
      description: Audit log entry for status changes
      properties:
        timestamp:
          type: string
          format: date-time
          description: When the status change occurred (ISO 8601 UTC)
          example: "2025-09-15T09:29:00Z"
        status:
          $ref: "#/components/schemas/ShippingStatus"
        message:
          type: string
          description: Human-readable description of the status change
          example: "Shipment is in distribution"

    # ===========================
    # TRANSPORT TYPE ENUM
    # ===========================
    TransportType:
      type: string
      enum: [air, sea, rail, road]
      description: |
        Available transport methods:
        - air: Fastest (1-3 days) but more expensive
        - road: Medium speed (3-7 days), most flexible
        - rail: Medium-slow (5-10 days), good for heavy cargo
        - sea: Slowest (15-30 days) but cheapest for large volumes

    # ===========================
    # SHIPPING STATUS ENUM
    # ===========================
    ShippingStatus:
      type: string
      enum:
        - created
        - reserved
        - in_transit
        - delivered
        - cancelled
        - in_distribution
        - arrived
      description: |
        Shipment lifecycle states:
        - created: Shipment record created, not yet dispatched
        - reserved: Inventory reserved, awaiting dispatch
        - in_transit: Package in transit to destination
        - arrived: Package arrived at destination facility
        - in_distribution: Out for delivery to final address
        - delivered: Successfully delivered to customer
        - cancelled: Shipment cancelled (only from created/reserved)

    # ===========================
    # REQUEST/RESPONSE SCHEMAS
    # ===========================
    
    ShippingCostRequest:
      type: object
      required: [delivery_address, products]
      description: |
        Request body for shipping cost calculation.
        
        Note: departure_postal_code is NOT sent in the request.
        Logistics queries Stock module for warehouse location based on product IDs.
      properties:
        delivery_address:
          $ref: "#/components/schemas/Address"
        products:
          type: array
          minItems: 1
          description: List of products with only ID and quantity (Stock provides the rest)
          items:
            $ref: "#/components/schemas/ProductRequest"

    ShippingCostResponse:
      type: object
      required: [currency, total_cost, transport_type, products]
      description: Shipping cost calculation result
      properties:
        currency:
          type: string
          description: Currency code (ISO 4217)
          example: "ARS"
        total_cost:
          type: number
          format: float
          description: Total shipping cost
          example: 45.5
        transport_type:
          $ref: "#/components/schemas/TransportType"
        products:
          type: array
          description: Individual cost breakdown per product
          items:
            type: object
            required: [id, cost]
            properties:
              id:
                type: integer
                description: Product ID
                example: 1
              cost:
                type: number
                format: float
                description: Shipping cost for this product
                example: 20.0

    TransportMethodsResponse:
      type: object
      required: [transport_methods]
      description: List of available transport methods
      properties:
        transport_methods:
          type: array
          items:
            type: object
            required: [type, name, estimated_days]
            properties:
              type:
                $ref: "#/components/schemas/TransportType"
              name:
                type: string
                description: Human-readable transport method name
                example: "Air Freight"
              estimated_days:
                type: string
                description: Estimated delivery time range
                example: "1-3"

    CreateShippingRequest:
      type: object
      required: [order_id, user_id, delivery_address, transport_type, products]
      description: |
        Request body for creating a new shipment.
        
        Customer Purchase Flow:
        1. Customer adds products to cart
        2. Customer enters delivery address
        3. Portal queries: GET /shipping/transport-methods (shows available options)
        4. Portal queries: POST /shipping/cost for each transport method (shows prices)
        5. Customer selects preferred transport method (air, road, rail, sea)
        6. Customer completes purchase â†’ Order created
        7. Portal calls this endpoint with customer's selected transport_type
        
        Integration Flow:
        1. Order Management sends: order_id, user_id, delivery_address, transport_type, product IDs
        2. Logistics queries Stock module for each product:
           - Weight and dimensions (for cost calculation)
           - Warehouse location (departure_postal_code)
        3. Logistics validates selected transport_type is available
        4. Logistics calculates final cost using customer's selected transport method
        5. Creates shipment with status 'created'
        6. Returns shipping_id to Order Management
        
        Note: transport_type is chosen by the customer during checkout.
      properties:
        order_id:
          type: integer
          description: Order ID from Order Management module
          example: 123
        user_id:
          type: integer
          description: Customer user ID
          example: 456
        delivery_address:
          $ref: "#/components/schemas/Address"
        transport_type:
          $ref: "#/components/schemas/TransportType"
          description: Transport method selected by customer during checkout
        products:
          type: array
          minItems: 1
          description: List of products with only ID and quantity (Stock provides weight, dimensions, warehouse)
          items:
            $ref: "#/components/schemas/ProductRequest"

    CreateShippingResponse:
      type: object
      required: [shipping_id, status, transport_type, estimated_delivery_at]
      description: Response after successful shipment creation
      properties:
        shipping_id:
          type: integer
          description: Unique shipment identifier (returned to Order Management)
          example: 789
        status:
          $ref: "#/components/schemas/ShippingStatus"
        transport_type:
          $ref: "#/components/schemas/TransportType"
        estimated_delivery_at:
          type: string
          format: date-time
          description: Estimated delivery date and time (ISO 8601 UTC)
          example: "2025-10-01T00:00:00Z"

    ShippingDetail:
      type: object
      required: [shipping_id, order_id, user_id, delivery_address, products, status, transport_type, estimated_delivery_at, created_at, updated_at, logs]
      description: Complete shipment information including all details and history
      properties:
        shipping_id:
          type: integer
          description: Unique shipment identifier
          example: 789
        order_id:
          type: integer
          description: Associated order ID from Order Management
          example: 123
        user_id:
          type: integer
          description: Customer user ID
          example: 456
        delivery_address:
          $ref: "#/components/schemas/Address"
        departure_address:
          $ref: "#/components/schemas/Address"
        products:
          type: array
          description: List of products in this shipment
          items:
            $ref: "#/components/schemas/ProductQty"
        status:
          $ref: "#/components/schemas/ShippingStatus"
        transport_type:
          $ref: "#/components/schemas/TransportType"
        tracking_number:
          type: string
          description: External tracking number from carrier
          example: "LOG-AR-123456789"
        carrier_name:
          type: string
          description: Name of the courier/carrier company
          example: "Express Logistics SA"
        total_cost:
          type: number
          format: float
          description: Total shipping cost
          example: 45.5
        currency:
          type: string
          description: Currency code (ISO 4217)
          example: "ARS"
        estimated_delivery_at:
          type: string
          format: date-time
          description: Estimated delivery date and time (ISO 8601 UTC)
          example: "2025-10-01T00:00:00Z"
        created_at:
          type: string
          format: date-time
          description: When the shipment was created (ISO 8601 UTC)
          example: "2025-09-01T10:00:00Z"
        updated_at:
          type: string
          format: date-time
          description: When the shipment was last updated (ISO 8601 UTC)
          example: "2025-09-15T09:29:00Z"
        logs:
          type: array
          description: Complete history of status changes
          items:
            $ref: "#/components/schemas/ShippingLog"

    ShippingListResponse:
      type: object
      required: [shipments, pagination]
      description: Paginated list of shipments with metadata
      properties:
        shipments:
          type: array
          description: Array of shipment summaries
          items:
            type: object
            required: [shipping_id, order_id, user_id, products, status, transport_type, estimated_delivery_at, created_at]
            properties:
              shipping_id:
                type: integer
                example: 789
              order_id:
                type: integer
                example: 123
              user_id:
                type: integer
                example: 456
              products:
                type: array
                items:
                  $ref: "#/components/schemas/ProductQty"
              status:
                $ref: "#/components/schemas/ShippingStatus"
              transport_type:
                $ref: "#/components/schemas/TransportType"
              estimated_delivery_at:
                type: string
                format: date-time
                example: "2025-10-01T00:00:00Z"
              created_at:
                type: string
                format: date-time
                example: "2025-09-01T10:00:00Z"
        pagination:
          type: object
          required: [current_page, total_pages, total_items, items_per_page]
          description: Pagination metadata
          properties:
            current_page:
              type: integer
              description: Current page number
              example: 1
            total_pages:
              type: integer
              description: Total number of pages
              example: 5
            total_items:
              type: integer
              description: Total number of shipments matching filters
              example: 87
            items_per_page:
              type: integer
              description: Number of items per page
              example: 20

    CancelShippingResponse:
      type: object
      required: [shipping_id, status, cancelled_at]
      description: Confirmation of shipment cancellation
      properties:
        shipping_id:
          type: integer
          example: 789
        status:
          $ref: "#/components/schemas/ShippingStatus"
        cancelled_at:
          type: string
          format: date-time
          description: When the shipment was cancelled (ISO 8601 UTC)
          example: "2025-09-18T19:00:00Z"

    # ===========================
    # ERROR SCHEMA
    # ===========================
    Error:
      type: object
      required: [code, message]
      description: Standard error response format used across all endpoints
      properties:
        code:
          type: string
          description: Machine-readable error code
          example: "unprocessable_entity"
        message:
          type: string
          description: Human-readable error message
          example: "Validation failed."
        details:
          oneOf:
            - type: string
            - type: object
            - type: array
          description: Additional error details (optional, format varies by error type)

  # ===========================
  # REUSABLE RESPONSES
  # ===========================
  responses:
    Error400:
      description: Bad Request - Malformed request data
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
          examples:
            malformed:
              value:
                code: "bad_request"
                message: "Malformed request body."

    Error401:
      description: Unauthorized - Missing or invalid authentication token
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
          examples:
            token:
              value:
                code: "unauthorized"
                message: "Missing or invalid token."

    Error404:
      description: Not Found - Requested resource does not exist
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
          examples:
            not_found:
              value:
                code: "not_found"
                message: "Resource not found."

    Error409:
      description: Conflict - State conflict or business rule violation
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
          examples:
            conflict:
              value:
                code: "conflict"
                message: "State conflict."

    Error422:
      description: Unprocessable Entity - Validation failed
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
          examples:
            validation:
              value:
                code: "unprocessable_entity"
                message: "Validation failed."
                details:
                  field_errors:
                    - field: "products[0].quantity"
                      message: "Must be >= 1"
                    - field: "delivery_address.postal_code"
                      message: "Must match Argentinian postal code format (e.g., H3500ABC)"

    Error500:
      description: Internal Server Error - Unexpected server error
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
          examples:
            internal:
              value:
                code: "server_error"
                message: "Unexpected error."

# ===========================
# GLOBAL SECURITY
# ===========================
security:
  - bearerAuth: []